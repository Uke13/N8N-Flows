{
  "active": false,
  "connections": {
    "IF (Image or Text?)": {
      "main": [
        [
          {
            "node": "Telegram (Get File)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "OpenRouter (Text Agent)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Telegram (Get File)": {
      "main": [
        [
          {
            "node": "OpenRouter (Vision Agent)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenRouter (Text Agent)": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "OpenRouter (Vision Agent)": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Sheets (Add Row)": {
      "main": [
        [
          {
            "node": "Google Sheets (Get Today's Rows)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Sheets (Get Today's Rows)": {
      "main": [
        [
          {
            "node": "Code (Calculate Totals)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code (Calculate Totals)": {
      "main": [
        [
          {
            "node": "Telegram (Send Update)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Telegram Trigger1": {
      "main": [
        [
          {
            "node": "IF (Image or Text?)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2025-07-29T21:39:10.584Z",
  "id": "F3sFsVZEGBagFzKv",
  "isArchived": false,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "name": "MACRO TRACKER BOT",
  "nodes": [
    {
      "parameters": {
        "updates": [
          "message"
        ],
        "additionalFields": {
          "chatIds": ""
        }
      },
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1.2,
      "position": [
        0,
        0
      ],
      "id": "aa1b4030-07fb-4e11-a19a-8b2d90501bef",
      "name": "Telegram Trigger",
      "webhookId": "c93f2d92-a5b7-4a55-bf11-30a8d54bf417",
      "credentials": {
        "telegramApi": {
          "id": "UQ0TGFdRm981nAK4",
          "name": "Telegram - MACRO TRACKER"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [
            {
              "value1": "={{ $trigger.item.json.message.photo }}",
              "operation": "exists"
            }
          ]
        }
      },
      "id": "2cf4508f-2992-46e1-9910-e40824088e5a",
      "name": "IF (Image or Text?)",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        -40,
        400
      ]
    },
    {
      "parameters": {
        "operation": "getFile"
      },
      "id": "59dad1c5-11ed-42d6-a832-d99aaf5bb0c0",
      "name": "Telegram (Get File)",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        160,
        300
      ],
      "webhookId": "22aa7db4-6c57-4c89-bbdd-026b35ecffa5"
    },
    {
      "parameters": {
        "url": "https://openrouter.ai/api/v1/chat/completions",
        "authentication": "headerAuth",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {}
          ]
        },
        "options": {}
      },
      "id": "ff1b432c-6fc7-4835-84c6-d23888434e0e",
      "name": "OpenRouter (Text Agent)",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        160,
        500
      ]
    },
    {
      "parameters": {
        "url": "https://openrouter.ai/api/v1/chat/completions",
        "authentication": "headerAuth",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {}
          ]
        },
        "options": {}
      },
      "id": "f4faeea6-e5c8-4c01-bbc0-6602c2bd6ac5",
      "name": "OpenRouter (Vision Agent)",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        360,
        300
      ]
    },
    {
      "parameters": {
        "mode": "mergeByPosition",
        "options": {}
      },
      "id": "b245c60a-5504-4b1a-bfd9-4a81e22a10d9",
      "name": "Merge",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 2,
      "position": [
        960,
        400
      ]
    },
    {
      "parameters": {},
      "id": "21942fd3-da10-4358-9b07-969db46d927b",
      "name": "Set (Prepare for Sheet)",
      "type": "n8n-nodes-base.set",
      "typeVersion": 2.2,
      "position": [
        1160,
        400
      ]
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": "",
        "sheetName": ""
      },
      "id": "95fad040-ea6e-4487-95bd-879595d0f13e",
      "name": "Google Sheets (Add Row)",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4,
      "position": [
        1360,
        400
      ]
    },
    {
      "parameters": {
        "documentId": "",
        "sheetName": ""
      },
      "id": "81c6ce6f-9b81-456c-83fd-b627819961a7",
      "name": "Google Sheets (Get Today's Rows)",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4,
      "position": [
        1560,
        400
      ]
    },
    {
      "parameters": {
        "jsCode": "// Initialize totals\nlet totalCalories = 0;\nlet totalProtein = 0;\nlet totalFat = 0;\nlet totalCarbs = 0;\nlet totalFiber = 0;\n\n// Loop through each item (row) from the Google Sheet\nfor (const item of items) {\n  // Add the value from each column to the total.\n  // The keys like 'CALORIES' must EXACTLY match your sheet headers.\n  totalCalories += parseFloat(item.json['CALORIES']) || 0;\n  totalProtein += parseFloat(item.json['PROTEIN']) || 0;\n  totalFat += parseFloat(item.json['FAT']) || 0;\n  totalCarbs += parseFloat(item.json['CARBS']) || 0;\n  totalFiber += parseFloat(item.json['FIBER']) || 0;\n}\n\n// Return a new object with the final totals\nreturn [{\n  json: {\n    totalCalories: totalCalories,\n    totalProtein: totalProtein,\n    totalFat: totalFat,\n    totalCarbs: totalCarbs,\n    totalFiber: totalFiber\n  }\n}];"
      },
      "id": "01e37ff7-66b5-449a-9bb1-37f6802510f9",
      "name": "Code (Calculate Totals)",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1760,
        400
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $('Set (Prepare for Sheet)').item.json.chatId }}",
        "text": "=âœ… Food logged successfully!\n\n*Today's Totals:*\n- *Calories:* {{ $json.totalCalories.toFixed(0) }} kcal\n- *Protein:* {{ $json.totalProtein.toFixed(1) }}g\n- *Fat:* {{ $json.totalFat.toFixed(1) }}g\n- *Carbs:* {{ $json.totalCarbs.toFixed(1) }}g\n- *Fiber:* {{ $json.totalFiber.toFixed(1) }}g",
        "additionalFields": {}
      },
      "id": "131c8f77-4b89-4911-a8ff-1ef8b1c6b57d",
      "name": "Telegram (Send Update)",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        1960,
        400
      ],
      "webhookId": "b5ee7ec8-834b-41d5-b0dc-62325d31b455"
    },
    {
      "parameters": {
        "additionalFields": {}
      },
      "id": "2e8d727a-d418-49f9-a19d-79be25134d52",
      "name": "Telegram Trigger1",
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1.1,
      "position": [
        -260,
        400
      ],
      "webhookId": "e551ee7c-2174-4e50-8db9-7773e730b981"
    }
  ],
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [],
  "triggerCount": 0,
  "updatedAt": "2025-07-29T21:50:49.620Z",
  "versionId": "5a940b06-367f-4e03-8b42-9408cdc09967"
}